From ea37026c9a393f7bc0b9421f4c34cccfbf3a8f35 Mon Sep 17 00:00:00 2001
From: Miguel Bernal Marin <miguel.bernal.marin@linux.intel.com>
Date: Fri, 20 Nov 2015 14:01:26 -0600
Subject: [PATCH 119/129] init: do_mounts: recreate /dev/root

Rootfs shows as is mounted in /dev/root, but this devices is not present in
/dev directory.

Signed-off-by: Miguel Bernal Marin <miguel.bernal.marin@linux.intel.com>
---
 init/do_mounts.c | 9 +++++++++
 1 file changed, 9 insertions(+)

diff --git a/init/do_mounts.c b/init/do_mounts.c
index a78e44ee6..c339046a2 100644
--- a/init/do_mounts.c
+++ b/init/do_mounts.c
@@ -568,6 +568,8 @@ void __init mount_root(void)
  */
 void __init prepare_namespace(void)
 {
+	int err;
+
 	if (root_delay) {
 		printk(KERN_INFO "Waiting %d sec before mounting root device...\n",
 		       root_delay);
@@ -615,6 +617,13 @@ void __init prepare_namespace(void)
 	devtmpfs_mount();
 	init_mount(".", "/", NULL, MS_MOVE, NULL);
 	init_chroot(".");
+#ifdef CONFIG_BLOCK
+	/* recreate the /dev/root */
+	err = create_dev("/dev/root", ROOT_DEV);
+
+	if (err < 0)
+		pr_emerg("Failed to create /dev/root: %d\n", err);
+#endif
 }
 
 static bool is_tmpfs;
-- 
2.31.1

